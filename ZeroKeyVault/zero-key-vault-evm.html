<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Zero-Key Vault – EVM 10-Chain</title>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@walletconnect/web3-provider@latest/dist/umd/index.min.js"></script>
<style>
body{font-family:Arial,Helvetica,sans-serif;margin:0;padding:1rem;background:linear-gradient(135deg,#111,#222);color:#eee}
h2{margin:.5rem 0;text-align:center}
input,select,button{width:100%;padding:.75rem;margin:.4rem 0;border-radius:8px;border:none;font-size:1rem}
button{background:#1e90ff;color:#fff;font-weight:600;cursor:pointer}
button:disabled{background:#555;cursor:not-allowed}
#status{margin-top:.5rem;font-size:.9rem;color:#0f0}
</style>
</head>
<body>
<h2>Zero-Key Vault – EVM</h2>

<select id="chainSel">
  <option value="1">Ethereum</option><option value="56">BNB Smart Chain</option><option value="137">Polygon</option>
  <option value="43114">Avalanche</option><option value="250">Fantom</option><option value="42161">Arbitrum</option>
  <option value="10">Optimism</option><option value="100">Gnosis</option><option value="25">Cronos</option>
  <option value="1313161554">Aurora</option>
</select>

<input id="dest"  placeholder="Destination address (0x…)" type="text"/>
<input id="amount" placeholder="Amount" type="number" step="any"/>
<button onclick="connectWallet()" id="connectBtn">Connect Wallet</button>
<button onclick="sendPrivate()" id="sendBtn" disabled>Send Privately</button>

<div id="status"></div>

<script>
/* ---------- CONFIG ---------- */
const ADDRESSES = {
  1   : "0xd53ac12902B9218734C2b8198797b6c1a02B4C29",
  56  : "0xd53ac12902B9218734C2b8198797b6c1a02B4C29",
  137 : "0xd53ac12902B9218734C2b8198797b6c1a02B4C29",
  43114: "0xd53ac12902B9218734C2b8198797b6c1a02B4C29",
  250 : "0xd53ac12902B9218734C2b8198797b6c1a02B4C29",
  42161: "0xd53ac12902B9218734C2b8198797b6c1a02B4C29",
  10  : "0xd53ac12902B9218734C2b8198797b6c1a02B4C29",
  100 : "0xd53ac12902B9218734C2b8198797b6c1a02B4C29",
  25  : "0xd53ac12902B9218734C2b8198797b6c1a02B4C29",
  1313161554: "0xd53ac12902B9218734C2b8198797b6c1a02B4C29"
};
const RPCS = {
  1:"https://eth.llamarpc.com",
  56:"https://bsc-dataseed.binance.org",
  137:"https://polygon-rpc.com",
  43114:"https://api.avax.network/ext/bc/C/rpc",
  250:"https://rpc.ftm.tools",
  42161:"https://arb1.arbitrum.io/rpc",
  10:"https://mainnet.optimism.io",
  100:"https://rpc.gnosischain.com",
  25:"https://evm.cronos.org",
  1313161554:"https://mainnet.aurora.dev"
};
let web3, account, chainId;

async function connectWallet() {
  const status = document.getElementById("status");
  status.textContent = "Connecting…";
  try {
    let provider;
    if (window.ethereum) {
      provider = window.ethereum;
      await provider.request({ method: "eth_requestAccounts" });
      web3 = new Web3(provider);
    } else {
      // WalletConnect fallback
      provider = new WalletConnectProvider.default({
        rpc: RPCS
      });
      await provider.enable();
      web3 = new Web3(provider);
    }
    const accounts = await web3.eth.getAccounts();
    account = accounts[0];
    chainId   = Number(await web3.eth.getChainId());
    document.getElementById("sendBtn").disabled = false;
    status.textContent = `Connected: ${account} on chain ${chainId}`;
  } catch (e) {
    document.getElementById("status").textContent = "Error: " + e.message;
  }
}

async function sendPrivate() {
  const dest = document.getElementById("dest").value;
  const amt  = document.getElementById("amount").value;
  if (!web3.utils.isAddress(dest)) return alert("Bad destination");
  const honor = ADDRESSES[chainId];
  const amountWei = web3.utils.toWei(amt);
  const fee = BigInt(amountWei) * 5n / 1000n;
  const net = BigInt(amountWei) - fee;

  // Ephemeral wallet
  const temp = web3.eth.accounts.create();
  const tempAddr = temp.address;
  const tempKey  = temp.privateKey;

  // tx1 user → temp
  const tx1 = {from: account, to: tempAddr, value: amountWei, gas: 21000};
  const hash1 = await web3.eth.sendTransaction(tx1);

  // tx2 temp → dest + honor
  const gasPrice = await web3.eth.getGasPrice();
  const tx2 = {to: dest, value: net.toString(), gas: 21000, gasPrice, nonce: 0};
  const signed2 = await web3.eth.accounts.signTransaction(tx2, tempKey);
  const hash2 = await web3.eth.sendSignedTransaction(signed2.rawTransaction);

  document.getElementById("status").textContent = `Done! TX1: ${hash1.transactionHash}\nTX2: ${hash2.transactionHash}`;
}
</script>
</body>
</html>
