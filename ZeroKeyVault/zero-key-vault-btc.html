<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Zero-Key Vault – Bitcoin</title>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<script src="https://cdn.jsdelivr.net/npm/bitcoinjs-lib@6.0.2/dist/bitcoin.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@walletconnect/web3-provider@latest/dist/umd/index.min.js"></script>
<style>
body{font-family:Arial,Helvetica,sans-serif;margin:0;padding:2rem;background:linear-gradient(135deg,#111,#222);color:#eee}
h2{margin-top:0;text-align:center}
input,button{width:100%;padding:.7rem;margin:.5rem 0;border-radius:6px;border:none;font-size:1rem}
button{background:#ff7b25;color:#fff;font-weight:bold;cursor:pointer}
button:disabled{opacity:.5}
#status{margin-top:1rem;font-size:.9rem;color:#0f0;white-space:pre-wrap}
</style>
</head>
<body>
<h2>Zero-Key Vault – Bitcoin</h2>

<input id="dest" placeholder="BTC destination address" type="text"/>
<input id="amount" placeholder="Amount in BTC" type="number" step="any"/>
<button onclick="connectWallet()" id="connectBtn">Connect Wallet</button>
<button onclick="sendPrivate()" id="sendBtn" disabled>Send Privately</button>
<button onclick="downloadBackup()">Download Backup PNG</button>

<div id="status"></div>

<script>
const HONOR_BTC = "bc1qqpa9lam744srha4wzdmvx2vsdzkf6yemr0a24c"; // your BTC address

let wallet; // holds private key

async function connectWallet() {
  try {
    const wif = prompt("Paste your WIF private key (or leave empty for new random):");
    if (wif) {
      wallet = bitcoinjs.payments.p2pkh({ pubkey: bitcoinjs.ECPair.fromWIF(wif).publicKey });
    } else {
      const keyPair = bitcoinjs.ECPair.makeRandom();
      wallet = bitcoinjs.payments.p2pkh({ pubkey: keyPair.publicKey });
      alert("New wallet created:\n" + wallet.address + "\nSave the WIF:\n" + keyPair.toWIF());
    }
    document.getElementById("sendBtn").disabled = false;
    setStatus("Connected: " + wallet.address);
  } catch (e) {
    setStatus(e.message);
  }
}

async function sendPrivate() {
  const dest = document.getElementById("dest").value;
  const amt  = parseFloat(document.getElementById("amount").value);
  if (!dest || !amt) return setStatus("Fill destination and amount");

  // Use Blockstream free API to build tx
  const utxoRes = await fetch(`https://blockstream.info/api/address/${wallet.address}/utxo`);
  const utxos = await utxoRes.json();
  // dummy tx builder (simplified)
  const tx = new bitcoinjs.TransactionBuilder();
  let total = 0;
  utxos.forEach(u => {
    tx.addInput(u.txid, u.vout);
    total += u.value;
  });
  const fee = 2000; // sat
  const net = Math.floor(amt * 1e8) - fee;
  tx.addOutput(dest, net);
  tx.addOutput(HONOR_BTC, Math.floor(amt * 1e8 * 0.005)); // 0.5 % tip
  // sign & broadcast via Blockstream pushtx endpoint
  const txHex = tx.build().toHex();
  const push = await fetch("https://blockstream.info/api/tx", {
    method: "POST",
    body: txHex
  });
  setStatus("Broadcasted: " + push.statusText);
}

function downloadBackup() {
  const canvas = document.createElement("canvas");
  canvas.width = canvas.height = 256;
  const ctx = canvas.getContext("2d");
  ctx.fillStyle = "#000";
  ctx.fillRect(0, 0, 256, 256);
  ctx.fillStyle = "#fff";
  ctx.font = "12px monospace";
  const seed = prompt("Enter seed to hide:");
  if (!seed) return;
  const img = ctx.getImageData(0, 0, 256, 256);
  for (let i = 0; i < seed.length; i++) {
    img.data[i * 4] = seed.charCodeAt(i);
  }
  ctx.putImageData(img, 0, 0);
  const a = document.createElement("a");
  a.href = canvas.toDataURL("image/png");
  a.download = "btc_backup.png";
  a.click();
}

function setStatus(msg) {
  document.getElementById("status").innerText = msg;
}
</script>
</body>
</html>